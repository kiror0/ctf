<!doctype html>

<html lang="en-us">

<head>
  <title>Catousify</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The HTML5 Herald" />
  <meta name="author" content="kiror0" /><meta name="generator" content="Hugo 0.62.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" />
  <script src="https://kit.fontawesome.com/b76b73e8e8.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  <link rel="stylesheet" type="text/css" href="http://zeroload.github.io/ctf/css/styles.css" /></head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="http://zeroload.github.io/ctf/">Catousify</a>
            </h1>

      <ul id="social-media">
        
        
          
        <li><a href="https://github.com/kiror0"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a></li>
           
      </ul>
      
      <p><em>No Clever Tagline Needed.</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="http://zeroload.github.io/ctf/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://zeroload.github.io/ctf/about/">
                <i class="fa-li fa  fa-lg"></i><span>About Me</span>
            </a>
        </li>
        
    </ul>
</nav>

    <main>




<article>

    <h1>SlashRoot 2018 - SNOW LAN(D)</h1>

    
        <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2018-07-28T22:29:20Z">Jul 28, 2018</time>
        </li>
        
        <li>
            Categories:
            <em>
                
                    
                    <a href="http://zeroload.github.io/ctf/categories/rev">rev</a>
                
                    , 
                    <a href="http://zeroload.github.io/ctf/categories/writeup">writeup</a>
                
            </em>
        </li>
        

        

        <li>3 minutes read</li>
    </ul>
</aside>

    

    <blockquote>
<p>Download : <a href="">SNOW LAN(D).apk</a></p>
</blockquote>
<h2 id="analisa">Analisa</h2>
<p>Hal yang paling pertama yang dilakukan untuk memudahkan analisa game di android itu biasanya <strong>identifikasi game engine</strong>, <em>why?</em> biar memudahkan reversing nantinya.</p>
<pre><code>λ › unzip -l SNOW\ LAN\(D\).apk
...
    18432  07-24-2018 16:07   assets/bin/Data/Managed/Assembly-CSharp.dll
...
  1243616  01-01-1980 08:00   assets/bin/Data/sharedassets1.resource
    17916  05-09-2018 23:03   lib/armeabi-v7a/libmain.so
  3791288  05-09-2018 22:59   lib/armeabi-v7a/libmono.so
 18400572  05-09-2018 23:04   lib/armeabi-v7a/libunity.so
     6372  05-09-2018 23:03   lib/x86/libmain.so
  3656924  05-09-2018 23:03   lib/x86/libmono.so
 24043552  05-09-2018 23:08   lib/x86/libunity.so
...
</code></pre><p>Dari data file tersebut sudah bisa ditebak game menggunakan Unity Game Engine. Selanjutnya, <em>ngapain?</em> Hampir semua logic dan kode utama game ada di <code>assets/bin/Data/Managed/Assembly-CSharp.dll</code>. File ini <code>.NET</code> dan bisa <em>didecompile</em> dengan <code>dnSpy</code> atau sejenisnya.</p>
<p>Familiarisasi dengan game dengan memainkannya, <del>yo welkam bek wit mi</del>. Ini foto dari <em>in-game</em>,</p>
<p><img src="" alt=""></p>
<p>Mirip platformer 2d pada umumnya(?). Darah ada 3, kalau jatuh, tabrak monster, atau kena duri darah berkurang. Sudah agak kebayang sedikit dari tahun lalu, karena ini soal <code>joy</code> jadi cuma perlu menyelesaikan game ini.</p>
<h2 id="pekalongan">Pekalongan</h2>
<p><img src="https://i.imgflip.com/1qjm83.jpg" alt=""></p>
<p>YASHH!! It's cheating time boiz. Buka <code>Assembly-CSharp.dll</code> pake <code>dnSpy</code> (recommended punya editor <em>kodingan</em> C# kalau belum terbiasa dengan MSIL). Platformer biar mudah selesainya, patch darah untuk gak berkurang. Fungsi yang lumayan bagus buat jadi awal carian itu biasanya Update untuk player controll.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#75715e">// PlayerController
</span><span style="color:#75715e"></span><span style="color:#75715e">// Token: 0x06000053 RID: 83 RVA: 0x00003180 File Offset: 0x00001380
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> FixedUpdate()
{
	<span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.curHealth &gt; <span style="color:#66d9ef">this</span>.maxHealth)
	{
		<span style="color:#66d9ef">this</span>.curHealth = <span style="color:#66d9ef">this</span>.maxHealth;
	}
	<span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.curHealth &lt;= <span style="color:#ae81ff">0</span>)
	{
		<span style="color:#66d9ef">this</span>.Die();
	}
	<span style="color:#66d9ef">if</span> (!<span style="color:#66d9ef">this</span>.canMove)
	{
		<span style="color:#66d9ef">return</span>;
	}
	<span style="color:#66d9ef">this</span>.isGrounded = Physics2D.OverlapCircle(<span style="color:#66d9ef">this</span>.tagGround.position, <span style="color:#66d9ef">this</span>.radius, <span style="color:#66d9ef">this</span>.playerMask);
	<span style="color:#66d9ef">this</span>.myAnim.UpdateIsGrounded(<span style="color:#66d9ef">this</span>.isGrounded);
	<span style="color:#66d9ef">if</span> (Input.GetButtonDown(<span style="color:#e6db74">&#34;Jump&#34;</span>))
	{
		<span style="color:#66d9ef">this</span>.Jump();
	}
	<span style="color:#66d9ef">this</span>.Move(<span style="color:#66d9ef">this</span>.hInput);
}
</code></pre></div><p><code>this.curHealth</code> bisa jadi indikator Health/darah Player, cari xrefs bisa lewat <code>Ctrl+Shift+R (Analyze)</code> &gt; <code>Assigned by</code>, cari semua yang mengurangi darah Player, dan patch untuk tidak mengurangi sama sekali. Sedikit contoh, <code>duri.OnCollisionEnter2D</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#75715e">// duri
</span><span style="color:#75715e"></span><span style="color:#75715e">// Token: 0x06000025 RID: 37 RVA: 0x00002C10 File Offset: 0x00000E10
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> OnCollisionEnter2D(Collision2D col)
{
	<span style="color:#66d9ef">if</span> (col.transform.CompareTag(<span style="color:#e6db74">&#34;Player&#34;</span>))
	{
		<span style="color:#66d9ef">this</span>.jump.velocity.y = <span style="color:#66d9ef">this</span>.jump.jumpVelocity;
		<span style="color:#66d9ef">this</span>.jump.myBody.velocity = <span style="color:#66d9ef">this</span>.jump.velocity;
		<span style="color:#66d9ef">this</span>.jump.curHealth -= <span style="color:#ae81ff">2</span>;
		<span style="color:#66d9ef">this</span>.blink.TriggerDamaged(<span style="color:#66d9ef">this</span>.jump.invicibleAfterDamaged);
	}
}
</code></pre></div><p>Patch/hapus bagian <code>this.jump.curHealth -= 2</code> serta yang lainnya, didapat mode <code>BAGUVIX</code>nya, hehe. Sedikit keluar dari bahas writeup, cara edit di <code>dnSpy</code> bisa pakai <code>Klik Kanan</code> &gt; <code>Edit Method C#</code> &gt; (kalau udah selesai edit) <code>Compile</code>. Kalau ada error? langsung edit <code>IL code</code> aja.</p>
<p>Lanjut, yang kedua ini agak unik karena saya sendiri gak terlalu jago untuk masalah <del>semua game</del> game seperti ini. Pas lagi bosen game ga selesai-selesai karena jatuh teruz muncul ide, <em><strong>Why not make this thing fly?</strong></em></p>
<p>Pada umumnya, algortima/logika untuk melompat di game itu seperti ini,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>player<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>isJump) {
	<span style="color:#75715e">// player can jump
</span><span style="color:#75715e"></span>} <span style="color:#66d9ef">else</span> {
	<span style="color:#75715e">// player is already in jump state
</span><span style="color:#75715e"></span>}
</code></pre></div><p>Apa jadinya kalau <code>if (!player-&gt;isJump)</code> di paksa <code>true</code>? yep, Player bisa selalu melompat di udara dengan kondisi <em>&ldquo;semi-flying state&rdquo;</em>. Fungsi <code>PlayerController.Jump</code>,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">using</span> System;
<span style="color:#66d9ef">using</span> UnityEngine;

<span style="color:#75715e">// Token: 0x02000015 RID: 21
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">partial</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PlayerController</span> : MonoBehaviour
{
	<span style="color:#75715e">// Token: 0x06000056 RID: 86 RVA: 0x000032AC File Offset: 0x000014AC
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Jump()
	{
		<span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.isGrounded)
		{
			<span style="color:#66d9ef">this</span>.myBody.velocity += <span style="color:#66d9ef">this</span>.jumpVelocity * Vector2.up;
			<span style="color:#66d9ef">this</span>.playerJump.clip = <span style="color:#66d9ef">this</span>.jump;
			<span style="color:#66d9ef">this</span>.playerJump.Play();
		}
	}
}
</code></pre></div><p>Langsung di patch aja, hapus block <code>if (this.isGrounded)</code> atau paksa jadi true (<code>if(true)</code>).</p>
<p>Terakhir, tinggal repack, sign, dan install di Android. Mainkan gamenya.</p>
<h2 id="demo">Demo</h2>
<p>{% youtube AkmacOXBfko %}</p>
<h2 id="flag">Flag</h2>
<!-- raw HTML omitted -->


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="http://zeroload.github.io/ctf/posts/ctfzone-2018-quals-android-ololo-country-checker/"><i class="fa fa-chevron-circle-left"></i> CTFZone 2018 Quals - android_ololo_country_checker</a>
        </li>
        
        
        <li>
            <a href="http://zeroload.github.io/ctf/posts/post-event-hacktoday-2018-quals/">Post Event HackToday 2018 Quals <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
    





</main>
    <footer>
        <h6>Copyright © 2019 - kiror0 |
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="http://zeroload.github.io/ctf/index.xml">Subscribe</a></h6>
    </footer>
</div>
<script src="http://zeroload.github.io/ctf/js/scripts.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146594173-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>

</html>
