<!doctype html>

<html lang="en-us">

<head>
  <title>Catousify</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The HTML5 Herald" />
  <meta name="author" content="kiror0" /><meta name="generator" content="Hugo 0.62.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" />
  <script src="https://kit.fontawesome.com/b76b73e8e8.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  <link rel="stylesheet" type="text/css" href="http://kiror0.github.io/ctf/css/styles.css" /></head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="http://kiror0.github.io/ctf/">Catousify</a>
            </h1>

      <ul id="social-media">
        
        
          
        <li><a href="https://github.com/kiror0"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a></li>
           
      </ul>
      
      <p><em>No Clever Tagline Needed.</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="http://kiror0.github.io/ctf/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://kiror0.github.io/ctf/about/">
                <i class="fa-li fa  fa-lg"></i><span>About Me</span>
            </a>
        </li>
        
    </ul>
</nav>

    <main>




<article>

    <h1>IDSECCONF 2017 Online - Darwin Writeup</h1>

    
        <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2017-12-12T20:02:30Z">Dec 12, 2017</time>
        </li>
        
        <li>
            Categories:
            <em>
                
                    
                    <a href="http://kiror0.github.io/ctf/categories/rev">rev</a>
                
                    , 
                    <a href="http://kiror0.github.io/ctf/categories/writeup">writeup</a>
                
            </em>
        </li>
        

        

        <li>5 minutes read</li>
    </ul>
</aside>

    

    <blockquote>
<p>Darwin (??? pts) <a href="https://a.safe.moe/Ph9RJ.zip">Download</a> Reverse Engineering Mach-O executable</p>
</blockquote>
<p>Diberikan sebuah binary Mach-O 32bit, langsung ke analisa binarynya</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">start</span>()
{
  <span style="color:#66d9ef">char</span> v0; <span style="color:#75715e">// al
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">int</span> result; <span style="color:#75715e">// eax
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">int</span> v2; <span style="color:#75715e">// [esp+44h] [ebp-44h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v3[<span style="color:#ae81ff">32</span>]; <span style="color:#75715e">// [esp+58h] [ebp-30h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v4; <span style="color:#75715e">// [esp+78h] [ebp-10h]
</span><span style="color:#75715e"></span>
  memset(v3, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x20u</span>);
  printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Enter the key : </span><span style="color:#e6db74">&#34;</span>);
  fflush(__stdoutp);
  v2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  fgets(v3, <span style="color:#ae81ff">32</span>, __stdinp);
  <span style="color:#66d9ef">while</span> ( v2 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">32</span> )
  {
    v0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">if</span> ( v3[v2] <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> )
      v0 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>;
    v3[v2<span style="color:#f92672">+</span><span style="color:#f92672">+</span>] <span style="color:#f92672">+</span><span style="color:#f92672">=</span> v0;
  }
  <span style="color:#66d9ef">if</span> ( sub_1A30((<span style="color:#66d9ef">int</span>)v3) )
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Congratz, the flag :</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">nflag{yOu_%s_3v3r}</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n</span><span style="color:#e6db74">&#34;</span>, v3);
  <span style="color:#66d9ef">else</span>
    printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Wrong %s not the key.</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n</span><span style="color:#e6db74">&#34;</span>, v3);
  result <span style="color:#f92672">=</span> <span style="color:#ae81ff">7566</span>;
  <span style="color:#66d9ef">if</span> ( __stack_chk_guard <span style="color:#f92672">=</span><span style="color:#f92672">=</span> v4 )
    result <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">return</span> result;
}
</code></pre></div><p>Intinya, program meminta input dan melakukan pengecekan input pada fungsi sub_1A30.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">BOOL <span style="color:#66d9ef">__cdecl</span> <span style="color:#a6e22e">sub_1A30</span>(<span style="color:#66d9ef">int</span> a1)
{
  <span style="color:#66d9ef">int</span> v2; <span style="color:#75715e">// [esp+1Ch] [ebp-5Ch]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v3; <span style="color:#75715e">// [esp+20h] [ebp-58h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v4; <span style="color:#75715e">// [esp+2Ch] [ebp-4Ch]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v5; <span style="color:#75715e">// [esp+30h] [ebp-48h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v6; <span style="color:#75715e">// [esp+34h] [ebp-44h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v7; <span style="color:#75715e">// [esp+38h] [ebp-40h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">int</span> k; <span style="color:#75715e">// [esp+40h] [ebp-38h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> j; <span style="color:#75715e">// [esp+44h] [ebp-34h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">int</span> i; <span style="color:#75715e">// [esp+48h] [ebp-30h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v11; <span style="color:#75715e">// [esp+4Ch] [ebp-2Ch]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v12; <span style="color:#75715e">// [esp+50h] [ebp-28h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v13; <span style="color:#75715e">// [esp+54h] [ebp-24h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v14; <span style="color:#75715e">// [esp+58h] [ebp-20h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v15; <span style="color:#75715e">// [esp+5Ch] [ebp-1Ch]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v16; <span style="color:#75715e">// [esp+60h] [ebp-18h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v17; <span style="color:#75715e">// [esp+64h] [ebp-14h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">int</span> v18; <span style="color:#75715e">// [esp+68h] [ebp-10h]
</span><span style="color:#75715e"></span>
  v18 <span style="color:#f92672">=</span> strlen((<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)a1);
  v17 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  v16 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  v15 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  v14 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  v13 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  v12 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> v18; <span style="color:#f92672">+</span><span style="color:#f92672">+</span>i )
  {
    <span style="color:#66d9ef">if</span> ( i <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> )
      v7 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> i) <span style="color:#f92672">^</span> v14;
    <span style="color:#66d9ef">else</span>
      v7 <span style="color:#f92672">=</span> v14;
    v14 <span style="color:#f92672">=</span> v7;
    <span style="color:#66d9ef">if</span> ( i <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> )
      v6 <span style="color:#f92672">=</span> v13;
    <span style="color:#66d9ef">else</span>
      v6 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> i) <span style="color:#f92672">^</span> v13;
    v13 <span style="color:#f92672">=</span> v6;
    <span style="color:#66d9ef">if</span> ( i <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> )
      v5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">else</span>
      v5 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> i);
    v17 <span style="color:#f92672">+</span><span style="color:#f92672">=</span> v5;
    <span style="color:#66d9ef">if</span> ( i <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> )
      v4 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> i) <span style="color:#f92672">^</span> v15;
    <span style="color:#66d9ef">else</span>
      v4 <span style="color:#f92672">=</span> v15;
    v15 <span style="color:#f92672">=</span> v4;
  }
  <span style="color:#66d9ef">for</span> ( j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> v18 <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>; <span style="color:#f92672">+</span><span style="color:#f92672">+</span>j )
    v12 <span style="color:#f92672">^</span><span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> j);
  <span style="color:#66d9ef">for</span> ( k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; k <span style="color:#f92672">&lt;</span> v18; <span style="color:#f92672">+</span><span style="color:#f92672">+</span>k )
  {
    <span style="color:#66d9ef">if</span> ( k <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> )
      v3 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> k);
    <span style="color:#66d9ef">else</span>
      v3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    v16 <span style="color:#f92672">+</span><span style="color:#f92672">=</span> v3;
    <span style="color:#66d9ef">if</span> ( k <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> )
      v2 <span style="color:#f92672">=</span> v15;
    <span style="color:#66d9ef">else</span>
      v2 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> k) <span style="color:#f92672">^</span> v15;
    v15 <span style="color:#f92672">=</span> v2;
  }
  v11 <span style="color:#f92672">=</span> sub_19C0(a1);
  <span style="color:#66d9ef">return</span> v17 <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> v16 <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> v17 <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> v18 <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> v15 <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> v12 <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> v14 <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">56</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> (v16 <span style="color:#f92672">+</span> v17) <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">116</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> (v16 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> v17) <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">183</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#f92672">*</span>(_BYTE <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">3</span><span style="color:#e6db74">&#39;</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#f92672">*</span>(_BYTE <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">5</span><span style="color:#e6db74">&#39;</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#f92672">*</span>(_BYTE <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">4</span><span style="color:#e6db74">&#39;</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#f92672">*</span>(_BYTE <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">7</span><span style="color:#e6db74">&#39;</span>
      <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> v11 <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0xFD4E6A44</span>;
}
</code></pre></div><p>Dapat diketahui, panjang string input harus 13 karakter, dan input[1] == &lsquo;3&rsquo;, input[5] == &lsquo;5&rsquo;, input[8] == &lsquo;4&rsquo;, input[10] == &lsquo;7&rsquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">v18 <span style="color:#f92672">=</span> strlen((<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)a1);
...
<span style="color:#66d9ef">return</span> ... <span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> v18 <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>
... 
<span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#f92672">*</span>(_BYTE <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">3</span><span style="color:#e6db74">&#39;</span>
<span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#f92672">*</span>(_BYTE <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">5</span><span style="color:#e6db74">&#39;</span>
<span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#f92672">*</span>(_BYTE <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">4</span><span style="color:#e6db74">&#39;</span>
<span style="color:#f92672">&amp;</span><span style="color:#f92672">&amp;</span> <span style="color:#f92672">*</span>(_BYTE <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">7</span><span style="color:#e6db74">&#39;</span>
</code></pre></div><p>Nah, selebihnya dapat dianalisa lebih lanjut pada 3 loop-for di dapat,</p>
<pre><code>v12 = input[0] ^ input[1] ^ input[2] ^ input[3] ^ input[4] ^ input[5]
v14 = input[1] ^ input[3] ^ input[5] ^ input[7] ^ input[9] ^ input[11]
v15 = input[0] ^ input[1] ^ input[2] ^ input[3] ^ input[4] ^ input[5] ^ input[6] ^ input[7] ^ input[8] ^ input[9] ^ input[10] ^ input[11] ^ input[12]
v12 == 21
v14 == 56
v15 == 90

v16 = input[0] + input[2] + input[4] + input[6] + input[8] + input[10] + input[12]
v17 = input[1] + input[3] + input[5] + input[7] + input[9] + input[11]
v17 % 10 == 8
v16 % 10 == v17 % 10
(v16 + v17) / 10 == 116
(v16 + 2 * v17) / 10 == 183
</code></pre><p>Nah, untuk mengetahui value pasti dari v17 dan v16 bisa dihitung manual,</p>
<pre><code>v17 = ??8
v16 = ??8
...
v16 + 17 = 1166
v16 + 2*v17 = 1834
...
v16 == 668
v17 == 498
</code></pre><p>Lanjut untuk analisa value dari v11,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">__cdecl</span> <span style="color:#a6e22e">sub_19C0</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>a1)
{
  <span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">int</span> i; <span style="color:#75715e">// [esp+8h] [ebp-10h]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v3; <span style="color:#75715e">// [esp+Ch] [ebp-Ch]
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">int</span> v4; <span style="color:#75715e">// [esp+10h] [ebp-8h]
</span><span style="color:#75715e"></span>
  v4 <span style="color:#f92672">=</span> strlen(a1);
  v3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">23</span>;
  <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> v4; <span style="color:#f92672">+</span><span style="color:#f92672">+</span>i )
    v3 <span style="color:#f92672">=</span> (a1[i] <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> i) <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">*</span> v3;   <span style="color:#66d9ef">return</span> v3 <span style="color:#f92672">&gt;</span><span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">4</span>;
}
</code></pre></div><p>Ugh.. konstrain untuk flag sudah makin ribet. Langsung aja ke intinya, soal-soal tipe seperti ini bisa digunakan SMT solver seperti z3 dengan menambahkan constaraint-constaraint diatas, berikut kodenya</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> z3 <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>

s <span style="color:#f92672">=</span> Solver()

str <span style="color:#f92672">=</span> [BitVec(i, <span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> xrange(<span style="color:#ae81ff">13</span>)]

<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> str:
    s<span style="color:#f92672">.</span>add(x <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0x20</span>, x <span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0x7e</span>)

s<span style="color:#f92672">.</span>add(str[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> ord(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">3</span><span style="color:#e6db74">&#39;</span>))
s<span style="color:#f92672">.</span>add(str[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">==</span> ord(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">5</span><span style="color:#e6db74">&#39;</span>))
s<span style="color:#f92672">.</span>add(str[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">==</span> ord(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">4</span><span style="color:#e6db74">&#39;</span>))
s<span style="color:#f92672">.</span>add(str[<span style="color:#ae81ff">10</span>] <span style="color:#f92672">==</span> ord(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">7</span><span style="color:#e6db74">&#39;</span>))

s<span style="color:#f92672">.</span>add(str[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">21</span>)
s<span style="color:#f92672">.</span>add(str[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">9</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">10</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">11</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">12</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">90</span>)
s<span style="color:#f92672">.</span>add(str[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">9</span>] <span style="color:#f92672">^</span> str[<span style="color:#ae81ff">11</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">56</span>)

s<span style="color:#f92672">.</span>add(str[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">10</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">12</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">668</span>)
s<span style="color:#f92672">.</span>add(str[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">7</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">9</span>] <span style="color:#f92672">+</span> str[<span style="color:#ae81ff">11</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">498</span>)

v3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">23</span>
<span style="color:#66d9ef">for</span> i, char <span style="color:#f92672">in</span> enumerate(str):
    v3 <span style="color:#f92672">=</span> ((char <span style="color:#f92672">&lt;&lt;</span> i) <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">*</span> v3) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffff</span> v3 <span style="color:#f92672">=</span> (v3 <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffff</span>

s<span style="color:#f92672">.</span>add(v3 <span style="color:#f92672">==</span> <span style="color:#ae81ff">0xFD4E6A44</span>)

<span style="color:#66d9ef">if</span> s<span style="color:#f92672">.</span>check() <span style="color:#f92672">==</span> sat:
    model <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>model()
    flag <span style="color:#f92672">=</span> [chr(model[x]<span style="color:#f92672">.</span>as_long()) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> str]
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(flag)
<span style="color:#66d9ef">else</span>:
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Nope :(</span><span style="color:#e6db74">&#39;</span>
</code></pre></div><p>Jalankan kodenya, didapatkan flag,</p>
<p>FLAG : <code>flag{yOu_r3ver5eM4s7er_3v3r}</code></p>
<hr>
<p>Side note: tbh ini ngerjainnya semalam suntuk. Hanya karena tidak menggunakan python2 waktu mengerjakan. Kenapa pengaruh banget? Iya, ini serius, vm ctfbox yang dipakai default python diubah ke python3 dan entah kenapa pas menjalankan kodingan diatas selalu return unsatisfied :(. Udah beberapa jam tapi gak sadar juga, sampai akhirnya coba pakai python2 dan output dapat satisfied (yeay). Whats learned? Coba-coba baca issues di github kalau nge-stuck. Pakai python2 buat solve sesuatu berhubungan dengan z3/SMT solver lain. Original idea by Bang Alfan (<a href="http://maulvi-cs.blogspot.com/)">http://maulvi-cs.blogspot.com/)</a>.</p>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="http://kiror0.github.io/ctf/posts/seccon-2017-powerful-shell-writeup/"><i class="fa fa-chevron-circle-left"></i> SECCON 2017 - Powerful_Shell Writeup</a>
        </li>
        
        
        <li>
            <a href="http://kiror0.github.io/ctf/posts/inctf-2017-secure-auth-writeup/">INCTF 2017 - Secure Auth Writeup <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
    





</main>
    <footer>
        <h6>Copyright © 2019 - kiror0 |
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="http://kiror0.github.io/ctf/index.xml">Subscribe</a></h6>
    </footer>
</div>
<script src="http://kiror0.github.io/ctf/js/scripts.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146594173-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>

</html>
